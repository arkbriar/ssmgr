!function(t){function n(e){if(o[e])return o[e].exports;var r=o[e]={exports:{},id:e,loaded:!1};return t[e].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var o={};return n.m=t,n.c=o,n.p="",n(0)}([function(t,n,o){"use strict";o(1),o(2),o(3),o(4),o(5),o(6)},function(t,n){"use strict";n.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ja.qr"])},function(t,n,o){"use strict";var e=o(1).app;e.config(["$urlRouterProvider","$locationProvider",function(t,n){n.html5Mode(!0),t.when("","/").otherwise("/")}]),e.config(["$stateProvider",function(t){t.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("account",{url:"/{id:[0-9a-f]{32}}",controller:"AccountController",templateUrl:"/public/views/account.html"}).state("about",{url:"/about",controller:"AboutController",templateUrl:"/public/views/about.html"})}])},function(t,n,o){"use strict";var e=o(1).app;e.config(["$stateProvider",function(t){t.state("password",{url:"/password",controller:"PasswordController",templateUrl:"/public/views/password.html"}).state("manager",{url:"/manager",controller:"ManagerController",templateUrl:"/public/views/manager.html"}).state("user",{url:"/user",controller:"UserController",templateUrl:"/public/views/user.html"})}])},function(t,n,o){"use strict";var e=o(1).app;e.filter("flow1024",function(){var t=1e3,n=1e3*t,o=1e3*n,e=1e3*o;return function(r){return r<t?r+" B":r<n?(r/t).toFixed(1)+" KB":r<o?(r/n).toFixed(1)+" MB":r<e?(r/o).toFixed(2)+" GB":r}}).filter("relativeTime",function(){function t(t){var n="",o="",e=+new Date-new Date(t);e<0?e=-e:o="前";var r=Math.trunc(e/864e5),i=Math.trunc(e%864e5/36e5),c=Math.trunc(e%864e5%36e5/6e4);return r&&(n+=r+"天"),(r||i)&&(n+=i+"小时"),r||!i&&!c||(n+=c+"分钟"),e<6e4&&(n="几秒"),n+o}return t.$stateful=!0,t})},function(t,n,o){"use strict";var e=o(1).app;e.controller("MainController",["$scope","$http","$state","$mdDialog","$interval",function(t,n,o,e,r){t.interval=null,t.setInterval=function(n){t.interval=n},t.showAlert=function(t,n){e.show(e.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(t).textContent(n).ariaLabel("alert").ok("确定"))},t.isLoading=!1,t.loading=function(n){t.isLoading=n},t.back=function(){o.go("index")},t.title="",t.setTitle=function(n){t.title=n},t.setBackButton=function(n){t.back=n},t.menus=[],t.setMenu=function(n){t.menus=n},t.$on("$stateChangeStart",function(n,e,i,c,a){t.interval&&r.cancel(t.interval),t.title="",t.back=function(){o.go("index")},t.menus=[]})}]).controller("IndexController",["$scope","$http","$state","$timeout",function(t,n,o,e){t.setTitle("Free Shadowsocks");var r=function(){t.setMenu([{icon:"settings",text:"管理",click:function(){n.post("/config").then(function(){o.go("manager")}).catch(function(){o.go("password")})}},{icon:"info_outline",text:"关于",click:function(){o.go("about")}}])};e(function(){r()},250),t.user={},t.sendCode=function(){t.loading(!0),n.post("/email",{email:t.user.email}).then(function(n){t.loading(!1),t.showAlert("提示","验证码发送成功。")}).catch(function(n){t.loading(!1),t.showAlert("错误","验证码发送失败。")})},t.checkCode=function(){t.loading(!0),n.post("/code",{email:t.user.email,code:("000000"+t.user.code).substr(-6)}).then(function(t){o.go("account",{id:t.data})}).catch(function(n){if(t.loading(!1),n.data.startsWith("out of limit, ")){var o=n.data.split(",")[1].split(".")[0].trim(),e=n.data.split(",")[1].split(".")[1].trim();if("user"===o){if("day"===e)return t.showAlert("错误","该邮箱本日申请次数超过限额。");if("week"===e)return t.showAlert("错误","该邮箱本周申请次数超过限额。");if("month"===e)return t.showAlert("错误","该邮箱本月申请次数超过限额。")}if("global"===o){if("day"===e)return t.showAlert("错误","本日免费帐号申请次数已达上限。");if("week"===e)return t.showAlert("错误","本周免费帐号申请次数已达上限。");if("month"===e)return t.showAlert("错误","本月免费帐号申请次数已达上限。")}}t.showAlert("错误","验证失败。")})},t.emailKeypress=function(n){13===n.keyCode&&t.user.email&&t.sendCode()},t.codeKeypress=function(n){13===n.keyCode&&t.user.code&&t.checkCode()},t.manager=function(){n.post("/config").then(function(){o.go("manager")}).catch(function(){o.go("password")})},t.about=function(){o.go("about")}}]).controller("AccountController",["$scope","$http","$state","$stateParams","$interval",function(t,n,o,e,r){t.qrcode="";var i=function(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,n){return String.fromCharCode("0x"+n)}))};t.getAccount=function(){t.qrcode||t.loading(!0),n.post("/account",{address:e.id}).then(function(n){t.loading(!1),t.accountInfo=n.data,t.qrcode="ss://"+i(t.accountInfo.method+":"+t.accountInfo.password+"@"+t.accountInfo.host+":"+t.accountInfo.port)},function(n){t.loading(!1),o.go("index")})},t.getAccount();var c=r(function(){t.getAccount()},6e4);t.setInterval(c)}]).controller("AboutController",["$scope","$http","$state",function(t,n,o){}])},function(t,n,o){"use strict";var e=o(1).app;e.controller("PasswordController",["$scope","$http","$state",function(t,n,o){t.setMenu([]),t.user={},t.checkPassword=function(){t.loading(!0),n.post("/password",{password:t.user.password}).then(function(){o.go("manager")}).catch(function(){t.loading(!1),t.showAlert("错误","管理员密码验证失败。")})},t.passwordKeypress=function(n){13===n.keyCode&&t.user.password&&t.checkPassword()}}]).controller("ManagerController",["$scope","$http","$state","$interval","$timeout",function(t,n,o,e,r){var i=function(){t.setMenu([{icon:"person",text:"用户",click:function(){o.go("user")}},{icon:"exit_to_app",text:"退出",click:function(){n.post("/logout").then(function(){t.setConfig(),o.go("index")})}}])};r(function(){i()},250);var c="",a="";t.config={shadowsocks:{flow:300,time:120},limit:{user:{day:0,week:0,month:0},global:{day:0,week:0,month:0}}},t.getConfig=function(){t.loading(!0),n.post("/config").then(function(n){t.loading(!1),t.config=n.data,c=JSON.stringify(t.config),a=JSON.stringify(t.config)}).catch(function(n){t.loading(!1),401===n.status&&o.go("password")})},t.getConfig(),t.setBackButton(function(){s&&e.cancel(s),t.setConfig(),o.go("index")}),t.setConfig=function(){a!==c&&(c=a,n.put("/config",t.config))};var s=e(function(){t.isLoading||(a=JSON.stringify(t.config),t.setConfig())},1e3);t.setInterval(s)}]).controller("UserController",["$scope","$http","$state","$interval","$timeout",function(t,n,o,e,r){var i=function(){t.setMenu([{icon:"build",text:"配置",click:function(){o.go("manager")}},{icon:"exit_to_app",text:"退出",click:function(){n.post("/logout").then(function(){o.go("index")})}}])};r(function(){i()},250),t.getUser=function(){t.users||t.loading(!0),n.post("/user").then(function(o){return t.users=o.data,n.post("/flow")}).then(function(n){t.flow=n.data.flow,t.loading(!1)}).catch(function(n){t.loading(!1),401===n.status&&o.go("password")})},t.getUser();var c=e(function(){t.getUser()},6e4);t.setInterval(c),t.toAccount=function(t){o.go("account",{id:t})}}])}]);